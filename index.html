<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄鐘計時器 - 郭庭華</title>
    <style>
        /* 1. 網頁背景設為淺黃色 */
        body {
            background-color: #FFFFE0; /* Light Yellow */
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Arial', sans-serif;
            transition: background-color 0.3s;
        }

        /* 10. 簽名資訊樣式 */
        #signature {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
            color: #333;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 8px;
            line-height: 1.5;
        }

        /* 2. 番茄鐘表面設為橘紅色, 8. 大小為 500px*500px */
        #pomodoro-clock {
            width: 500px;
            height: 500px;
            background-color: #FF4500; /* Orange Red */
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 5px solid #8B0000; /* 深紅色邊框增加立體感 */
            position: relative;
        }

        /* 葉子裝飾 (增加番茄感) */
        #pomodoro-clock::before {
            content: '';
            position: absolute;
            top: -20px;
            width: 40px;
            height: 40px;
            background-color: #228B22;
            border-radius: 10px;
            transform: rotate(45deg);
        }

        /* 4. 時間顯示區域 */
        #timer-display {
            font-size: 100px;
            color: white;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            font-family: 'Courier New', monospace; /* 等寬字體避免數字跳動 */
        }

        /* 輸入框區域 (設定時顯示) */
        #settings-panel {
            display: none; /* 預設隱藏 */
            margin-bottom: 20px;
        }

        .time-input {
            width: 80px;
            height: 60px;
            font-size: 40px;
            text-align: center;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
        }

        /* 按鈕樣式 */
        .btn-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            background-color: white;
            color: #FF4500;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        button:hover {
            background-color: #f0f0f0;
        }

        /* 5. 計時截止前3分鐘時，時間數字會閃爍且加粗 */
        @keyframes blinkBold {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        .urgent {
            animation: blinkBold 1s infinite;
            font-weight: 900 !important; /* 加粗 */
            color: #FFFF00 !important; /* 改為黃色以示警示 */
        }

        /* 6. 計時截止時網頁背景設為淺黃色與深咖啡交互顯示 */
        @keyframes bgFlash {
            0% { background-color: #FFFFE0; } /* 淺黃 */
            50% { background-color: #4B3621; } /* 深咖啡 (Dark Brown) */
            100% { background-color: #FFFFE0; }
        }

        .alarm-active {
            animation: bgFlash 0.5s infinite;
        }

        /* 截止時文字變為閃爍紅色 */
        .time-up-text {
            color: #4B3621 !important;
        }

    </style>
</head>
<body>

    <div id="signature">
        學號: 41418117<br>
        姓名: 郭庭華<br>
        日期: 2025/12/22
    </div>

    <div id="pomodoro-clock">
        
        <div id="timer-display">25:00</div>

        <div id="settings-panel">
            <input type="number" id="input-min" class="time-input" placeholder="分" min="0" max="99" value="25">
            <span style="font-size: 40px; color: white;">:</span>
            <input type="number" id="input-sec" class="time-input" placeholder="秒" min="0" max="59" value="00">
        </div>

        <div class="btn-group">
            <button id="btn-start" onclick="startTimer()">開始</button>
            <button id="btn-settings" onclick="toggleSettings()">設定</button>
            <button id="btn-clear" onclick="clearTimer()">清除/重置</button>
        </div>
    </div>

    <script>
        // 變數宣告
        let timerInterval = null;
        let totalSeconds = 1500; // 預設 25 分鐘
        let initialSeconds = 1500; // 用於重置
        let isRunning = false;
        let isSettingsMode = false;

        // DOM 元素
        const displayEl = document.getElementById('timer-display');
        const bodyEl = document.body;
        const settingsPanel = document.getElementById('settings-panel');
        const inputMin = document.getElementById('input-min');
        const inputSec = document.getElementById('input-sec');
        const btnStart = document.getElementById('btn-start');
        const btnSettings = document.getElementById('btn-settings');

        // 初始化顯示
        updateDisplay();

        // 更新畫面時間文字
        function updateDisplay() {
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;

            // 補零格式化
            let minStr = minutes < 10 ? "0" + minutes : minutes;
            let secStr = seconds < 10 ? "0" + seconds : seconds;

            displayEl.textContent = `${minStr}:${secStr}`;
        }

        // 開始計時
        function startTimer() {
            if (isRunning) return; // 防止重複點擊
            if (totalSeconds === 0 && !isSettingsMode) {
                alert("請先設定時間！");
                return;
            }

            // 如果在設定模式下按開始，先確認設定
            if (isSettingsMode) {
                applySettings();
            }

            isRunning = true;
            btnStart.textContent = "計時中...";
            btnStart.disabled = true; // 鎖定開始按鈕
            btnSettings.disabled = true; // 鎖定設定按鈕

            // 清除之前的背景閃爍
            bodyEl.classList.remove('alarm-active');
            displayEl.classList.remove('time-up-text');

            timerInterval = setInterval(() => {
                if (totalSeconds > 0) {
                    totalSeconds--;
                    updateDisplay();
                    checkWarning(); // 檢查是否需要閃爍
                } else {
                    // 時間到
                    timeUp();
                }
            }, 1000);
        }

        // 5. 檢查是否進入最後3分鐘 (180秒)
        function checkWarning() {
            if (totalSeconds <= 180 && totalSeconds > 0) {
                displayEl.classList.add('urgent');
            } else {
                displayEl.classList.remove('urgent');
            }
        }

        // 6. 時間到觸發
        function timeUp() {
            clearInterval(timerInterval);
            isRunning = false;
            totalSeconds = 0;
            updateDisplay();
            
            displayEl.classList.remove('urgent');
            displayEl.classList.add('time-up-text');
            
            // 背景閃爍
            bodyEl.classList.add('alarm-active');
            
            btnStart.textContent = "開始";
            btnStart.disabled = false;
            btnSettings.disabled = false;
        }

        // 7. 清除/重置按鈕
        function clearTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            
            // 恢復到最近一次設定的時間
            totalSeconds = initialSeconds; 
            
            // 移除所有特效
            bodyEl.classList.remove('alarm-active');
            displayEl.classList.remove('urgent');
            displayEl.classList.remove('time-up-text');

            btnStart.textContent = "開始";
            btnStart.disabled = false;
            btnSettings.disabled = false;

            // 如果正在設定模式，也順便關閉
            if(isSettingsMode) {
                toggleSettings();
            }
            
            updateDisplay();
        }

        // 7. 切換設定模式
        function toggleSettings() {
            isSettingsMode = !isSettingsMode;

            if (isSettingsMode) {
                // 進入設定模式：隱藏時間，顯示輸入框
                displayEl.style.display = 'none';
                settingsPanel.style.display = 'block';
                btnSettings.textContent = "確認設定";
                
                // 帶入當前數值到輸入框
                let currentMin = Math.floor(totalSeconds / 60);
                let currentSec = totalSeconds % 60;
                inputMin.value = currentMin;
                inputSec.value = currentSec < 10 ? "0" + currentSec : currentSec;
                
            } else {
                // 離開設定模式 (按下確認)
                applySettings();
            }
        }

        // 應用設定值
        function applySettings() {
            let m = parseInt(inputMin.value);
            let s = parseInt(inputSec.value);

            // 驗證輸入範圍
            if (isNaN(m)) m = 0;
            if (isNaN(s)) s = 0;
            
            // 3. 最長 99分 59秒
            if (m > 99) m = 99;
            if (s > 59) s = 59;
            if (m < 0) m = 0;
            if (s < 0) s = 0;

            // 更新全域變數
            totalSeconds = (m * 60) + s;
            initialSeconds = totalSeconds; // 記住這個設定值以便清除時恢復

            // 更新 UI
            updateDisplay();
            
            // 切換回顯示模式
            displayEl.style.display = 'block';
            settingsPanel.style.display = 'none';
            btnSettings.textContent = "設定";
            
            // 移除任何殘留的警示樣式
            displayEl.classList.remove('urgent');
            isSettingsMode = false;
        }

    </script>
</body>
</html>